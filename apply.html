<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Apply — EGR Careers</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <link href="/css/careers.css" rel="stylesheet">
  <script> const API_BASE = 'https://script.google.com/macros/s/PUT_YOUR_SCRIPT_ID/exec'; </script>
</head>
<body>
  <header class="nav"><div class="container nav-container">
    <div class="brand">Emirates Group Roblox</div>
    <nav class="links">
      <a href="/index.html">Home</a>
      <a href="/jobs.html">Jobs</a>
      <a href="/dashboard.html">My Applications</a>
      <div id="localTime">--:--</div>
      <button id="authBtn" class="btn btn-primary">HR Sign In</button>
    </nav>
  </div></header>

  <section class="hero-modern"><div class="container"><h1>Application</h1><p class="small">Complete the form below to apply.</p></div></section>

  <main class="container" style="max-width:800px;margin:1.5rem auto;">
    <form id="applyForm" class="card form-modern">
      <label>Position</label>
      <input id="jobTitle" name="jobTitle" readonly>

      <label>Full Name</label>
      <input id="fullName" required>

      <label>Age</label>
      <input id="age" type="number" required>

      <label>Email</label>
      <input id="email" type="email" required>

      <label>Discord Username (username#1234)</label>
      <input id="discordUsername" required>

      <label>Discord ID (numeric)</label>
      <input id="discordId" required>

      <label>Roblox Username</label>
      <input id="robloxUsername" required>

      <label>Country</label>
      <input id="country" required>

      <label>Region / City</label>
      <input id="region" required>

      <label>Cover / Message</label>
      <textarea id="cover" required></textarea>

      <label>Upload CV (PDF)</label>
      <input id="resume" type="file" accept="application/pdf" required>

      <div class="form-actions" style="margin-top:1rem">
        <button class="btn btn-primary" type="submit">Submit Application</button>
        <a class="btn btn-ghost" href="/jobs.html">Cancel</a>
      </div>
    </form>
  </main>

  <footer class="footer-modern"><div class="container footer-container">
    <div>© 2025 Emirates Group Roblox — All Rights Reserved</div>
    <div class="footer-links"><a href="/terms.html">Terms</a> · <a href="/privacy.html">Privacy</a></div>
  </div></footer>

<script>
function qs(name) {
  const url = new URL(location.href);
  return url.searchParams.get(name);
}
document.getElementById('jobTitle').value = qs('job') || 'General Application';
const jobId = qs('jobId') || '';

async function toBase64(file){
  return new Promise((res,rej)=>{
    const reader=new FileReader();
    reader.onload=()=> res(reader.result.split(',')[1]);
    reader.onerror=rej;
    reader.readAsDataURL(file);
  });
}

document.getElementById('applyForm').addEventListener('submit', async (ev)=>{
  ev.preventDefault();
  const fullName = document.getElementById('fullName').value.trim();
  const age = document.getElementById('age').value.trim();
  const email = document.getElementById('email').value.trim();
  const discordUsername = document.getElementById('discordUsername').value.trim();
  const discordId = document.getElementById('discordId').value.trim();
  const robloxUsername = document.getElementById('robloxUsername').value.trim();
  const country = document.getElementById('country').value.trim();
  const region = document.getElementById('region').value.trim();
  const cover = document.getElementById('cover').value.trim();
  const resumeInput = document.getElementById('resume');
  if(!resumeInput.files.length){ alert('Upload your CV (PDF).'); return; }
  const resumeFile = resumeInput.files[0];
  const resumeBase64 = await toBase64(resumeFile);
  const payload = {
    path: 'submitApplication',
    jobId: jobId,
    jobTitle: document.getElementById('jobTitle').value,
    fullName, age, email, discordUsername, discordId, robloxUsername, country, region, cover,
    resumeBase64, resumeName: resumeFile.name
  };
  try {
    const r = await fetch(API_BASE, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    const json = await r.json();
    if(json.ok){
      alert('Application submitted — thank you!');
      location.href = '/dashboard.html';
    } else {
      alert('Could not submit: ' + (json.err||'unknown error'));
    }
  } catch(err){
    console.error(err);
    alert('Failed to submit. Check console.');
  }
});
</script>
</body>
</html>
