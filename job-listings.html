<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Open Roles — Emirates Group Roblox Careers</title>
  <meta name="description" content="Open roles at Emirates Group Roblox. Search, filter, and apply for jobs." />
  <meta name="theme-color" content="#c8102e" />
  <style>
    /* Embedded CSS — matches the index site theme (corporate, futuristic) */
    :root{
      --brand:#c8102e;
      --accent:#ffd24a;
      --bg:#071123;
      --panel:#0b1220;
      --muted:#9aa4b2;
      --text:#e6eef8;
      --glass: rgba(255,255,255,0.02);
      --radius:12px;
      --container:1180px;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;color:var(--text);background:linear-gradient(180deg,#061423 0%, #04101a 100%);-webkit-font-smoothing:antialiased}
    a{color:inherit}
    .container{max-width:var(--container);margin:0 auto;padding:22px}
    /* Header */
    header.site-header{position:sticky;top:0;background:linear-gradient(90deg, rgba(0,0,0,0.25), rgba(0,0,0,0.15));backdrop-filter: blur(6px);border-bottom:1px solid rgba(255,255,255,0.02);z-index:50}
    .header-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 22px;max-width:var(--container);margin:0 auto}
    .brand{display:flex;align-items:center;gap:10px}
    .brand .name{font-weight:800;color:var(--accent);font-size:18px}
    nav.main-nav{display:flex;gap:10px;align-items:center}
    nav.main-nav a{padding:8px 10px;border-radius:8px;font-weight:700}
    nav.main-nav a:hover{background:var(--glass)}
    .btn{padding:8px 12px;border-radius:8px;border:0;cursor:pointer;font-weight:800}
    .btn-primary{background:var(--brand);color:white}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--text)}
    /* Page header */
    .page-header{padding:28px 0;border-bottom:1px solid rgba(255,255,255,0.02)}
    .page-grid{display:flex;gap:22px;align-items:flex-start;flex-wrap:wrap}
    .page-left{flex:1;min-width:300px}
    .page-right{width:360px;min-width:260px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:16px;border-radius:12px;border:1px solid rgba(255,255,255,0.02)}
    .page-title{font-size:24px;margin-bottom:8px}
    .lead{color:var(--muted);margin-bottom:14px}
    /* Controls */
    .controls{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
    .search{flex:1;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
    .select{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text)}
    /* Job list */
    .jobs-list{display:grid;grid-template-columns:repeat(auto-fit,minmax(320px,1fr));gap:12px}
    .job-card{padding:14px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border:1px solid rgba(255,255,255,0.02)}
    .job-title{font-weight:800}
    .job-meta{color:var(--muted);font-size:13px;margin-top:6px}
    .job-actions{display:flex;gap:8px;margin-top:10px}
    /* Job detail panel */
    .detail-panel{padding:18px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02)}
    .detail-header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap}
    .detail-title{font-size:20px;font-weight:900}
    .detail-meta{color:var(--muted);font-size:13px}
    .detail-body{margin-top:12px;color:var(--text);line-height:1.6}
    /* Apply modal */
    #applyModalOuter{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;padding:16px;z-index:9999}
    #applyModal{width:100%;max-width:760px;background:linear-gradient(180deg,#07111a,#051016);padding:18px;border-radius:12px;border:1px solid rgba(255,255,255,0.03)}
    #applyModal input,#applyModal textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);margin-top:6px}
    /* Footer */
    footer.site-footer{padding:28px 0;border-top:1px solid rgba(255,255,255,0.02);margin-top:28px}
    .footer-inner{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
    .muted{color:var(--muted)}
    /* Responsive */
    @media(max-width:880px){
      .page-grid{flex-direction:column}
      nav.main-nav{display:none}
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header" role="banner">
    <div class="header-inner container">
      <div class="brand">
        <div class="name" style="font-size:16px;color:var(--accent)">Emirates Group Roblox</div>
        <div class="muted" style="font-size:12px;margin-left:6px">Careers Portal</div>
      </div>

      <nav class="main-nav" role="navigation" aria-label="Main">
        <a href="index.html">Home</a>
        <a href="job-listings.html">Openings</a>
        <a href="about.html">About</a>
        <a href="employee-rights.html">Employee Rights</a>
        <a href="applicant.html">Applicant Portal</a>
        <a class="btn btn-ghost" href="hr.html">HR Portal</a>
      </nav>
    </div>
  </header>

  <!-- Page header -->
  <main>
    <section class="page-header">
      <div class="container page-grid">
        <div class="page-left">
          <div class="page-title">Open roles at Emirates Group Roblox</div>
          <p class="lead">Browse current job openings, read full role descriptions and apply online. Roles are managed by the HR team and updated in real-time.</p>
        </div>

        <aside class="page-right">
          <div class="panel">
            <div style="display:flex;justify-content:space-between;align-items:center">
              <div>
                <div style="font-size:12px;color:var(--muted)">Local time</div>
                <div id="localTime" style="font-weight:800;margin-top:6px">--:--</div>
              </div>
              <div>
                <div style="font-size:12px;color:var(--muted)">Dubai (HR)</div>
                <div id="dubaiTime" style="font-weight:800;margin-top:6px">--:--</div>
              </div>
            </div>
            <div style="margin-top:12px;color:var(--muted)" id="hrStatus">Checking HR status...</div>
          </div>

          <div style="height:12px"></div>

          <div class="panel" style="margin-top:12px">
            <strong>Need help applying?</strong>
            <p class="muted" style="margin-top:8px">Visit the Applicant Portal or join our Discord for support.</p>
            <div style="margin-top:10px;display:flex;gap:8px">
              <a class="btn btn-primary" href="applicant.html">Applicant Portal</a>
              <a class="btn btn-ghost" id="discordLink" href="#" target="_blank">Discord</a>
            </div>
          </div>
        </aside>
      </div>
    </section>

    <!-- Main content -->
    <section class="panel-section">
      <div class="container page-grid">
        <div class="page-left">
          <div class="controls">
            <input id="searchInput" class="search" type="search" placeholder="Search by title, keywords, division..." aria-label="Search jobs" />
            <select id="statusFilter" class="select" aria-label="Status filter">
              <option value="">All statuses</option><option value="Open">Open</option><option value="Closed">Closed</option><option value="Draft">Draft</option>
            </select>
            <select id="divisionFilter" class="select" aria-label="Division filter">
              <option value="">All divisions</option>
              <option>Flight Operations</option>
              <option>Customer Service</option>
              <option>Ground Operations</option>
              <option>HR & Recruitment</option>
              <option>IT & Systems</option>
            </select>
            <button id="searchBtn" class="btn btn-ghost">Search</button>
          </div>

          <div id="jobsList" class="jobs-list" role="list" aria-live="polite">
            <!-- Jobs will be rendered here -->
            <div class="job-card">Loading jobs…</div>
          </div>
        </div>

        <aside class="page-right">
          <div id="detailPanel" class="detail-panel" aria-live="polite">
            <div class="detail-header">
              <div>
                <div class="detail-title" id="detailTitle">Select a job to view details</div>
                <div class="detail-meta muted" id="detailMeta">Job details will appear here</div>
              </div>
              <div>
                <button id="printJob" class="btn btn-ghost">Print</button>
              </div>
            </div>
            <div class="detail-body" id="detailBody" style="margin-top:12px">
              <p class="muted">No job selected. Click a role on the left to view full description, requirements and to apply.</p>
            </div>
            <div style="margin-top:12px;display:flex;gap:8px">
              <button id="applyBtn" class="btn btn-primary" disabled>Apply</button>
              <button id="saveJob" class="btn btn-ghost" disabled>Save</button>
              <button id="shareJob" class="btn btn-ghost" disabled>Copy link</button>
            </div>
          </div>
        </aside>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="container footer-inner">
      <div>
        <div style="font-weight:700">Emirates Group Roblox</div>
        <div class="muted" style="font-size:13px">Careers portal — professional community operations</div>
        <div style="margin-top:8px;font-size:13px;color:var(--muted)">© <span id="year"></span></div>
      </div>
      <div style="display:flex;gap:12px;align-items:center">
        <a class="muted" href="employee-rights.html">Employee Rights</a>
        <a class="muted" href="about.html">About</a>
        <a id="discordFooter" class="btn btn-ghost" href="#" target="_blank">Discord</a>
      </div>
    </div>
  </footer>

  <!-- Apply Modal placeholder (in DOM when opened) -->
  <!-- Scripts -->
  <script>
    /* CONFIG - replace with your Apps Script web app URL and Discord invite */
    const API_URL = '<<PASTE_YOUR_APPS_SCRIPT_WEBAPP_URL>>'; // e.g. https://script.google.com/macros/s/XXX/exec
    const DISCORD_INVITE = 'https://discord.gg/your-invite';

    // Utilities
    const esc = s => String(s||'').replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    const $ = sel => document.querySelector(sel);
    const $all = sel => Array.from(document.querySelectorAll(sel));

    // Live clocks (local + Dubai)
    function updateClocks(){
      const now = new Date();
      $('#localTime').textContent = now.toLocaleString(undefined, {weekday:'short', day:'numeric', month:'short', hour:'2-digit', minute:'2-digit', hour12:false});
      try {
        const parts = new Intl.DateTimeFormat('en-GB', {timeZone:'Asia/Dubai', hour12:false, weekday:'short', day:'numeric', month:'short', hour:'2-digit', minute:'2-digit'}).formatToParts(new Date());
        let weekday='', hour=0, minute=0;
        parts.forEach(p => { if (p.type==='weekday') weekday=p.value; if (p.type==='hour') hour=parseInt(p.value,10); if (p.type==='minute') minute=parseInt(p.value,10); });
        $('#dubaiTime').textContent = weekday + ' ' + String(hour).padStart(2,'0') + ':' + String(minute).padStart(2,'0');
        // HR status logic
        const wk = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
        let dayIndex = wk.indexOf(weekday);
        if (dayIndex < 0) {
          // fallback
          const dub = new Date(new Intl.DateTimeFormat('en-GB', {timeZone:'Asia/Dubai'}).format());
          dayIndex = dub.getDay();
          hour = dub.getHours();
        }
        let active = false;
        if (dayIndex >=1 && dayIndex <=4) active = (hour >=9 && hour <19);
        else active = (hour >=7 && hour <22);
        $('#hrStatus').textContent = active ? 'HR is Online — responding during office hours' : 'HR is Offline — outside office hours';
      } catch(e){
        console.warn('Dubai time error', e);
      }
    }
    setInterval(updateClocks, 1000);
    updateClocks();

    // Discord links
    $('#discordLink').href = DISCORD_INVITE;
    $('#discordFooter').href = DISCORD_INVITE;

    // Fetching jobs from API or sample fallback
    const SAMPLE_JOBS = [
      { job_id:'JOB-001', title:'Customer Service Agent', division:'Customer Service', location:'Remote', status:'Open', summary:'Handle passenger enquiries via Discord & in-game channels.', description:'Full role description here. Provide friendly support to passengers, manage complaints and escalate when required.', requirements:'Good communication, 13+ years, Roblox account.' },
      { job_id:'JOB-002', title:'Flight Operations Coordinator', division:'Flight Operations', location:'Virtual Hub', status:'Open', summary:'Plan and coordinate group flights, scheduling and crew assignments.', description:'Coordinate PIREPs, assign pilots, maintain flight logs.', requirements:'Attention to detail, scheduling experience.' },
      { job_id:'JOB-003', title:'Ground Ops Assistant', division:'Ground Operations', location:'Virtual Hub', status:'Closed', summary:'Support ramp & baggage operations in virtual environment.', description:'Supervise ramp procedures and baggage handling.', requirements:'Reliable, team-player.' }
    ];

    async function apiGet(path, params={}) {
      if (!API_URL || API_URL.includes('PASTE_YOUR')) return null;
      try {
        const url = new URL(API_URL);
        url.searchParams.set('path', path);
        Object.keys(params).forEach(k => url.searchParams.set(k, params[k]));
        const res = await fetch(url.toString());
        return await res.json();
      } catch(err){
        console.error('API error', err);
        return null;
      }
    }

    async function loadJobs(q='', status='', division='') {
      const list = $('#jobsList');
      list.innerHTML = '<div class="job-card">Loading…</div>';
      if (!API_URL || API_URL.includes('PASTE_YOUR')) {
        // filter sample data
        const filtered = SAMPLE_JOBS.filter(j => {
          const matchesQ = !q || (j.title+j.summary+j.division).toLowerCase().includes(q.toLowerCase());
          const matchesStatus = !status || j.status === status;
          const matchesDiv = !division || j.division === division;
          return matchesQ && matchesStatus && matchesDiv;
        });
        renderJobList(filtered);
        updateStats(filtered, SAMPLE_JOBS.length, 1); // sample counts
        return;
      }

      const resp = await apiGet('getJobs', { q, status });
      if (resp && resp.ok) {
        const jobs = resp.jobs || [];
        const filtered = jobs.filter(j => !division || j.division === division);
        renderJobList(filtered);
        // also fetch apps and hr count
        const appsResp = await apiGet('getApplications');
        const hrResp = await apiGet('getHRList');
        updateStats(jobs, (appsResp && appsResp.applications) || [], (hrResp && hrResp.hr) || []);
      } else {
        renderJobList(SAMPLE_JOBS);
        updateStats(SAMPLE_JOBS, [], 1);
      }
    }

    function renderJobList(jobs) {
      const list = $('#jobsList');
      if (!jobs || jobs.length === 0) { list.innerHTML = '<div class="job-card">No roles found.</div>'; return; }
      list.innerHTML = jobs.map(j => `
        <div class="job-card" role="listitem" data-id="${esc(j.job_id)}">
          <div class="job-title">${esc(j.title)}</div>
          <div class="job-meta">${esc(j.division)} • ${esc(j.location)} • <strong>${esc(j.status)}</strong></div>
          <div class="muted" style="margin-top:8px">${esc(j.summary || '')}</div>
          <div class="job-actions">
            <button class="btn btn-primary" onclick="openApplyModal('${esc(j.job_id)}','${esc(j.title)}')">Apply</button>
            <button class="btn btn-ghost" onclick="viewJob('${esc(j.job_id)}')">View</button>
          </div>
        </div>
      `).join('');
      // Attach click handlers for selecting jobs
      $all('.job-card').forEach(el => {
        el.addEventListener('click', (e) => {
          const id = el.getAttribute('data-id');
          // Only open detail if clicking on card (not on buttons)
          if (!e.target.closest('button')) viewJob(id);
        });
      });
    }

    // Update stats (simple)
    function updateStats(jobs = [], apps = [], hr = []) {
      const openCount = (jobs.filter ? jobs.filter(j => (j.status||'').toLowerCase()==='open').length : (jobs.length || 0));
      $('#stat-open')?.textContent !== undefined ? document.getElementById('stat-open')?.textContent = openCount : null;
      // If we had stat elements on this page, update them. Here we'll leave counts minimal.
    }

    // View job: either lookup from API or sample
    async function viewJob(jobId) {
      // Try to find in rendered job list first
      const jobEl = document.querySelector(`.job-card[data-id="${jobId}"]`);
      if (jobEl) {
        // fetch job data from list or API
      }
      // If API exists, fetch job by scanning getJobs or by ID (no dedicated endpoint in sample)
      if (!API_URL || API_URL.includes('PASTE_YOUR')) {
        const job = SAMPLE_JOBS.find(j => j.job_id === jobId);
        populateDetail(job || null);
        history.replaceState({}, '', 'job-listings.html?job=' + encodeURIComponent(jobId));
        return;
      }
      // With API: fetch all jobs and find match
      const resp = await apiGet('getJobs', {});
      const job = resp && resp.jobs ? resp.jobs.find(j => j.job_id === jobId) : null;
      populateDetail(job || null);
      history.replaceState({}, '', 'job-listings.html?job=' + encodeURIComponent(jobId));
    }

    // Populate detail panel
    function populateDetail(job) {
      const title = $('#detailTitle');
      const meta = $('#detailMeta');
      const body = $('#detailBody');
      const applyBtn = $('#applyBtn');
      const saveBtn = $('#saveJob');
      const shareBtn = $('#shareJob');

      if (!job) {
        title.textContent = 'Job not found';
        meta.textContent = '';
        body.innerHTML = '<p class="muted">We could not find that job. It may have been removed or the ID is incorrect.</p>';
        applyBtn.disabled = true; saveBtn.disabled = true; shareBtn.disabled = true;
        return;
      }

      title.textContent = job.title || 'Untitled role';
      meta.textContent = `${job.division || '—'} • ${job.location || '—'} • ${job.status || '—'}`;
      body.innerHTML = `
        <h4 style="margin-top:0">Overview</h4>
        <p>${esc(job.description || job.summary || '')}</p>
        <h4>Requirements</h4>
        <p>${esc(job.requirements || 'No requirements listed.')}</p>
        <h4>Responsibilities</h4>
        <p>${esc(job.responsibilities || 'No responsibilities listed.')}</p>
      `;
      applyBtn.disabled = false;
      saveBtn.disabled = false;
      shareBtn.disabled = false;

      // Wire actions
      applyBtn.onclick = () => openApplyModal(job.job_id, job.title);
      saveBtn.onclick = () => alert('Saved to your profile (feature coming soon).');
      shareBtn.onclick = () => { navigator.clipboard?.writeText(location.origin + '/job-listings.html?job=' + encodeURIComponent(job.job_id)); alert('Job link copied.'); };
    }

    // Apply modal implementation
    function openApplyModal(jobId, jobTitle) {
      // If already open, remove
      const existing = document.getElementById('applyModalOuter');
      if (existing) existing.remove();

      const outer = document.createElement('div');
      outer.id = 'applyModalOuter';
      outer.innerHTML = `
        <div id="applyModal" role="dialog" aria-modal="true" aria-label="Apply for job">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div style="font-weight:900">${esc(jobTitle || 'Apply')}</div>
            <button id="closeApply" class="btn btn-ghost">Close</button>
          </div>
          <form id="applyForm" style="margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:10px">
            <input type="hidden" name="job_id" value="${esc(jobId)}" />
            <div><label>First name</label><input name="first_name" required /></div>
            <div><label>Last name</label><input name="last_name" /></div>
            <div style="grid-column:1 / -1"><label>Email</label><input name="email" type="email" required /></div>
            <div><label>Discord username</label><input name="discord_username" /></div>
            <div><label>Discord ID</label><input name="discord_id" /></div>
            <div><label>Roblox username</label><input name="roblox_username" /></div>
            <div><label>Age</label><input name="age" type="number" /></div>
            <div><label>Country</label><input name="country" /></div>
            <div style="grid-column:1 / -1"><label>Why do you want this role?</label><textarea name="cover_letter" rows="4"></textarea></div>
            <div style="grid-column:1 / -1;display:flex;justify-content:flex-end;gap:8px;margin-top:6px">
              <button type="submit" class="btn btn-primary">Submit application</button>
              <button type="button" id="cancelApply" class="btn btn-ghost">Cancel</button>
            </div>
          </form>
        </div>
      `;
      document.body.appendChild(outer);
      document.getElementById('cancelApply').addEventListener('click', () => outer.remove());
      document.getElementById('closeApply').addEventListener('click', () => outer.remove());
      document.getElementById('applyForm').addEventListener('submit', async (ev) => {
        ev.preventDefault();
        const fm = new FormData(ev.target);
        const body = Object.fromEntries(fm.entries());
        // Simple validation
        if (!body.job_id || !body.email || !body.first_name) {
          alert('Please fill required fields.');
          return;
        }
        // If no API, simulate success
        if (!API_URL || API_URL.includes('PASTE_YOUR')) {
          alert('Application simulated (no API configured). Application ID: SIM-' + Math.floor(Math.random()*90000+10000));
          outer.remove();
          return;
        }
        try {
          const res = await fetch(API_URL, {
            method: 'POST',
            headers: {'Content-Type':'application/json'},
            body: JSON.stringify(Object.assign({ action: 'apply' }, body))
          });
          const j = await res.json();
          if (j && j.ok) {
            alert('Application submitted! ID: ' + (j.application_id || '—'));
            outer.remove();
          } else {
            alert('Error: ' + (j.error || 'unknown'));
          }
        } catch(err){
          console.error(err);
          alert('Network or server error when submitting application.');
        }
      });
    }

    // On load: parse query ?job= and load initial jobs
    function getQueryParam(name) {
      const params = new URLSearchParams(location.search);
      return params.get(name);
    }
    (function init(){
      // Wire search
      $('#searchBtn').addEventListener('click', ()=> {
        const q = $('#searchInput').value.trim();
        const status = $('#statusFilter').value;
        const division = $('#divisionFilter').value;
        loadJobs(q, status, division);
      });
      // Load initial list
      const initialJob = getQueryParam('job');
      loadJobs().then(() => {
        if (initialJob) viewJob(initialJob);
      });
      // Footer year
      $('#year').textContent = new Date().getFullYear();
    })();

    // Print handler for detail panel
    $('#printJob').addEventListener('click', ()=> {
      const title = document.getElementById('detailTitle').textContent;
      const content = document.getElementById('detailBody').innerHTML;
      const wnd = window.open('', '_blank');
      wnd.document.write(`<html><head><title>${esc(title)}</title><style>body{font-family:Arial;padding:20px;color:#111}h1{color:#c8102e}</style></head><body><h1>${esc(title)}</h1>${content}</body></html>`);
      wnd.document.close();
      wnd.print();
    });
  </script>
</body>
</html>
